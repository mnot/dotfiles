#!/bin/bash



umask 002

# OSX
export PATH="/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$HOME/Applications"  # known starting point
export BASH_SILENCE_DEPRECATION_WARNING=1

# Homebrew
export PATH="/opt/homebrew/sbin:/opt/homebrew/bin:$PATH"
export MANPATH="/opt/homebrew/manpages:$MANPATH"
export SPATH="/opt/homebrew/sbin:$SPATH"

PACKAGE_DATA=~/.package_data.json

if test ! -s ${PACKAGE_DATA}; then
    brew info --json saxon openjdk ruby > ${PACKAGE_DATA}
fi

function package_version {
    local package="$1"
    local version
    version="$( jq -r ".[] | select(.name == \"${package}\").installed[0].version" ${PACKAGE_DATA} )"
    echo "$version"
}

# GPG SSH
export SSH_AUTH_SOCK="$HOME/.gnupg/S.gpg-agent.ssh"
gpgconf --launch gpg-agent

# Ruby
export PATH="/opt/homebrew/opt/ruby/bin:/opt/homebrew/lib/ruby/gems/bin:$PATH"
export PKG_CONFIG_PATH="/opt/homebrew/opt/ruby/lib/pkgconfig"
export GEM_HOME="/opt/homebrew/lib/ruby/gems/"

# Java
java_version="$(package_version 'openjdk')"
export JAVA_HOME="/usr/local/Cellar/openjdk/${java_version}/libexec/openjdk.jdk/Contents/Home"
sax_version="$(package_version 'saxon')"
export saxpath="/usr/local/Cellar/saxon/${sax_version}/libexec/saxon-he-${sax_version}.jar"

# NodeJS
export NODE_PATH=/opt/homebrew/lib/node_modules
# export PATH="$PATH:/usr/local/share/npm/bin"

# Aliases
alias l="ls -GFoh"
alias la="ls -GAFlhe"
alias dnsflush="dscacheutil -flushcache"
alias pstree="ps -axwwco user,pid,ppid,pgid,command | /usr/local/bin/pstree -f -"
alias ldd="otool -L"
alias plop-view="python -m plop.viewer --datadir=."

